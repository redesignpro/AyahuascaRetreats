{% extends './base-listing.html' %}
{% load static %}
{% block content %}
            <div class="section-title">
              <h3>Food &amp; Drinks</h3>
              <small class="title-description"> Introduce the trip and highlight what&#39;s unique about your program </small>
              <div class="recommendation-actions">
                <div class="modal fade add_recommendations_modal" id="add_recommendations_modal_intro" tabindex="-1" role="dialog" aria-label>
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">
                            <img src="./recommendationsClose.svg" class="add-recommendations-modal__close__image" />
                          </span>
                        </button>
                        <div class="modal-header__content">
                          <img src="./recommendations.svg" class="add-recommendations-modal__title__image" />
                          <h3>Add recommendation</h3>
                        </div>
                      </div>
                      <div class="add_recommendations_form">
                        <div class="modal-body">
                          <div class="form-group">
                            <label for="add-recommendation-title">Recommendation for</label>
                            <input type="text" class="form-control add-recommendation-title" placeholder="Title &amp; Intro (page)" value="Title &amp; Intro (page)" readonly />
                          </div>
                          <div class="form-group">
                            <label for="add-recommendation-type">Type <span id="add-recommendation-type-intro" class="badge hide">Required</span>
                            </label>
                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                              <label class="btn btn-default">
                                <input type="radio" name="type" value="comment" class="add-recommendation-type" autocomplete="off"> Comment </label>
                              <label class="btn btn-default">
                                <input type="radio" name="type" value="suggestion" autocomplete="off" class="add-recommendation-type"> Improvement </label>
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="add-recommendation-content">Recommendation <span id="add-recommendation-content-intro" class="badge hide">Required</span>
                            </label>
                            <textarea class="form-control add-recommendation-content" rows="3"></textarea>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                          <button class="btn btn-success add-recommendation-button" type="button" onclick="addRecommendation('intro', 'page', 'intro')">Save</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <script>
                  function addRecommendation(recommendationName, recommendationType, recommendationSection) {
                    let field = recommendationName;
                    let section = recommendationSection;
                    let targetForm = event.target.closest('.add_recommendations_form')
                    let feedback = $(targetForm).find('.add-recommendation-content').val();
                    let type = $(targetForm).find('.add-recommendation-type:checked').val();
                    let feedbackErrorElement = $(targetForm).find(`#add-recommendation-content-${recommendationName}`);
                    let typeErrorElement = $(targetForm).find(`#add-recommendation-type-${recommendationName}`);
                    let translations = {
                      "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                      "success": "Changes saved successfully"
                    }
                    if (recommendationType == 'page') {
                      section = recommendationSection;
                      field = '';
                    }
                    if (feedback == '' && type == undefined) {
                      feedbackErrorElement.removeClass('hide')
                      typeErrorElement.removeClass('hide');
                      return;
                    }
                    if (feedback == '') {
                      feedbackErrorElement.removeClass('hide');
                      return;
                    }
                    if (type == undefined) {
                      typeErrorElement.removeClass('hide');
                      return;
                    }
                    let formData = {
                      "type": type,
                      "section": section,
                      "field": field,
                      "feedback": feedback
                    }
                    let options = {
                      credentials: 'same-origin',
                      headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                      },
                      method: 'POST',
                      body: JSON.stringify(formData)
                    }
                    let url = '/4/listings/95462/feedback/json/create'
                    fetch(url, options).then(function(response) {
                      if (response.status != 400 && response.status != 200) {
                        flash.error(translations.error);
                        console.log(response);
                      } else {
                        flash.success(translations.success, function() {
                          flash.clear()
                        });
                        $(`#add_recommendations_modal_${recommendationName}`).modal('hide')
                        return response.json()
                      }
                    })
                  }
                </script>
              </div>
              <script>
                function showRecommendationHistory(name) {
                  let currentElement = event.target;
                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                  $(currentElement).toggleClass('hide');
                  $(currentElement).next().toggleClass('hide');
                }

                function hideRecommendationHistory(name) {
                  let currentElement = event.target;
                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                  $(currentElement).toggleClass('hide');
                  $(currentElement).prev().toggleClass('hide');
                }
              </script>

            </div>
            <div class="panel panel-default">
                <div class="panel-body -airy">
                    <div role="tabpanel" class="tab-pane active has-fixed-actions">
                      <script>
                        function completeRecommendation(recommendationId) {
                          let targetElement = event.target;
                          let translations = {
                            "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                            "success": "Changes saved successfully"
                          };
                          let options = {
                            credentials: 'same-origin',
                            headers: {
                              'Accept': 'application/json',
                              'Content-Type': 'application/json'
                            },
                            method: 'POST'
                          }
                          let url = `/4/listings/95462/feedback/${recommendationId}/json/complete`
                          fetch(url, options).then(function(response) {
                            if (response.status != 200) {
                              flash.error(translations.error);
                              console.log(response);
                            } else {
                              flash.success(translations.success, function() {
                                flash.clear()
                              });
                              $(targetElement).closest('.panel-body').find('.content-section span').html('[ Done ]');
                              $(targetElement).closest('.button-section').hide();
                              return response.json()
                            }
                          })
                        }
    
                        function dismissRecommendation(recommendationId, recommendationType) {
                          let targetElement = event.target;
                          let options = {
                            credentials: 'same-origin',
                            headers: {
                              'Accept': 'application/json',
                              'Content-Type': 'application/json'
                            },
                            method: 'POST'
                          }
                          let url = `/4/listings/95462/feedback/${recommendationId}/json/dismiss`
                          fetch(url, options).then(function(response) {
                            if (response.status != 200) {
                              flash.error(translations.error);
                              console.log(response);
                            } else {
                              flash.success(translations.success, function() {
                                flash.clear()
                              });
                              $(targetElement).closest('.panel-body').find('.content-section span').html('[ DISMISSED ]');
                              $(targetElement).closest('.button-section').hide();
                              return response.json()
                            }
                          })
                        }
    
                        function deleteRecommendation(recommendationId, recommendationType) {
                          let targetElement = event.target;
                          let options = {
                            credentials: 'same-origin',
                            headers: {
                              'Accept': 'application/json',
                              'Content-Type': 'application/json'
                            },
                            method: 'POST'
                          }
                          let url = `/4/listings/95462/feedback/${recommendationId}/json/delete`
                          if (window.confirm("Are you sure?")) {
                            fetch(url, options).then(function(response) {
                              if (response.status != 200) {
                                flash.error('Failed to delete recommendation. Try again or report to #application');
                                console.log(response);
                              } else {
                                flash.success(translations.success, function() {
                                  flash.clear()
                                });
                                $(targetElement).closest('.panel-body').hide();
                                return response.json()
                              }
                            })
                          }
                        }
    
                        function editRecommendation(recommendationName, type, id) {
                          $(`#edit_recommendations_modal_${recommendationName}_${type}_${id}`).modal('show');
                        }
                      </script>
                      <form id="food-drinks-form" class="js-serialize-this-form" method="POST"> {% csrf_token %} {{ form.media }}
                        <div class="row section-title">
                          <div class="col-md-9 col-sm-12">
                            <h3>Food</h3>
                            <!-- <small class="title-description">
                                            Pick the included and available food experience
                                        </small> -->
                          </div>
                        </div>
                        <!-- ------------------------------------------------INCLUDED MEALS --------------------------------------- -->
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-group ">
                              <label for="included_meals" class="control-label diff label-block"> Included meals </label>
                              <div class="form-helper"> Select all meals that are included in the package price. </div>
                              <div class="recommendation-actions">
                                <div class="modal fade add_recommendations_modal" id="add_recommendations_modal_included_meals" tabindex="-1" role="dialog" aria-label>
                                  <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">
                                            <img src="./recommendationsClose.svg" class="add-recommendations-modal__close__image" />
                                          </span>
                                        </button>
                                        <div class="modal-header__content">
                                          <img src="./recommendations.svg" class="add-recommendations-modal__title__image" />
                                          <h3>Add recommendation</h3>
                                        </div>
                                      </div>
                                      <div class="add_recommendations_form">
                                        <div class="modal-body">
                                          <div class="form-group">
                                            <label for="add-recommendation-title">Recommendation for</label>
                                            <input type="text" class="form-control add-recommendation-title" placeholder="Included meals (field)" value="Included meals (field)" readonly />
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-type">Type <span id="add-recommendation-type-included_meals" class="badge hide">Required</span>
                                            </label>
                                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="comment" class="add-recommendation-type" autocomplete="off"> Comment </label>
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="suggestion" autocomplete="off" class="add-recommendation-type"> Improvement </label>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-content">Recommendation <span id="add-recommendation-content-included_meals" class="badge hide">Required</span>
                                            </label>
                                            <textarea class="form-control add-recommendation-content" rows="3"></textarea>
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                          <button class="btn btn-success add-recommendation-button" type="button" onclick="addRecommendation('included_meals', 'field', 'foodAndDrinks')">Save</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <script>
                                  function addRecommendation(recommendationName, recommendationType, recommendationSection) {
                                    let field = recommendationName;
                                    let section = recommendationSection;
                                    let targetForm = event.target.closest('.add_recommendations_form')
                                    let feedback = $(targetForm).find('.add-recommendation-content').val();
                                    let type = $(targetForm).find('.add-recommendation-type:checked').val();
                                    let feedbackErrorElement = $(targetForm).find(`#add-recommendation-content-${recommendationName}`);
                                    let typeErrorElement = $(targetForm).find(`#add-recommendation-type-${recommendationName}`);
                                    let translations = {
                                      "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                      "success": "Changes saved successfully"
                                    }
                                    if (recommendationType == 'page') {
                                      section = recommendationSection;
                                      field = '';
                                    }
                                    if (feedback == '' && type == undefined) {
                                      feedbackErrorElement.removeClass('hide')
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (feedback == '') {
                                      feedbackErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (type == undefined) {
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    let formData = {
                                      "type": type,
                                      "section": section,
                                      "field": field,
                                      "feedback": feedback
                                    }
                                    let options = {
                                      credentials: 'same-origin',
                                      headers: {
                                        'Accept': 'application/json',
                                        'Content-Type': 'application/json'
                                      },
                                      method: 'POST',
                                      body: JSON.stringify(formData)
                                    }
                                    let url = '/4/listings/95462/feedback/json/create'
                                    fetch(url, options).then(function(response) {
                                      if (response.status != 400 && response.status != 200) {
                                        flash.error(translations.error);
                                        console.log(response);
                                      } else {
                                        flash.success(translations.success, function() {
                                          flash.clear()
                                        });
                                        $(`#add_recommendations_modal_${recommendationName}`).modal('hide')
                                        return response.json()
                                      }
                                    })
                                  }
                                </script>
                              </div>
                              <script>
                                function showRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).next().toggleClass('hide');
                                }
    
                                function hideRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).prev().toggleClass('hide');
                                }
                              </script>
                            </div>
                          </div>
                          <div class="col-lg-6 col-md-9 col-xs-12">
                            <div class="form-group">
                              <style>
                                #id_meals {
                                  columns: 2;
                                -webkit-columns: 2;
                                -moz-columns: 2;
                                list-style-type: none;
                              }
                              </style>
                              {{ form.meals }}
                            </div>
                            <script>
                              function completeRecommendation(recommendationId) {
                                let translations = {
                                  "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                  "success": "Changes saved successfully"
                                };
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/complete`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    flash.error(translations.error);
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ Done ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function dismissRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/dismiss`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    if (recommendationType == 'comment') {
                                      flash.error(translations.error);
                                    } else {
                                      flash.error(translations.error);
                                    }
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ DISMISSED ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function deleteRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/delete`
                                if (window.confirm("Are you sure?")) {
                                  fetch(url, options).then(function(response) {
                                    if (response.status != 200) {
                                      flash.error(translations.error);
                                      console.log(response);
                                    } else {
                                      flash.success(translations.success, function() {
                                        flash.clear()
                                      });
                                      $(targetElement).closest('.panel-body').hide();
                                      return response.json()
                                    }
                                  })
                                }
                              }
    
                              function editRecommendation(recommendationName, type, id) {
                                $(`#edit_recommendations_modal_${recommendationName}_${type}_${id}`).modal('show');
                              }
                            </script>
                          </div>
                        </div>
                        <!-- ------------------------------------------------SUPPORTED FOOD TYPES --------------------------------------- -->
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-group">
                              <label for="host" class="control-label label-block"> Food types &amp; dietary requirements </label>
                              <div class="form-helper"> Select all food types that are served, and any dietary requirements that are catered for. </div>
                              <div class="recommendation-actions">
                                <div class="modal fade add_recommendations_modal" id="add_recommendations_modal_supportedFoodTypes" tabindex="-1" role="dialog" aria-label>
                                  <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">
                                            <img src="./recommendationsClose.svg" class="add-recommendations-modal__close__image" />
                                          </span>
                                        </button>
                                        <div class="modal-header__content">
                                          <img src="./recommendations.svg" class="add-recommendations-modal__title__image" />
                                          <h3>Add recommendation</h3>
                                        </div>
                                      </div>
                                      <div class="add_recommendations_form">
                                        <div class="modal-body">
                                          <div class="form-group">
                                            <label for="add-recommendation-title">Recommendation for</label>
                                            <input type="text" class="form-control add-recommendation-title" placeholder="Food types &amp; dietary requirements (field)" value="Food types &amp; dietary requirements (field)" readonly />
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-type">Type <span id="add-recommendation-type-supportedFoodTypes" class="badge hide">Required</span>
                                            </label>
                                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="comment" class="add-recommendation-type" autocomplete="off"> Comment </label>
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="suggestion" autocomplete="off" class="add-recommendation-type"> Improvement </label>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-content">Recommendation <span id="add-recommendation-content-supportedFoodTypes" class="badge hide">Required</span>
                                            </label>
                                            <textarea class="form-control add-recommendation-content" rows="3"></textarea>
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                          <button class="btn btn-success add-recommendation-button" type="button" onclick="addRecommendation('supportedFoodTypes', 'field', 'foodAndDrinks')">Save</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <script>
                                  function addRecommendation(recommendationName, recommendationType, recommendationSection) {
                                    let field = recommendationName;
                                    let section = recommendationSection;
                                    let targetForm = event.target.closest('.add_recommendations_form')
                                    let feedback = $(targetForm).find('.add-recommendation-content').val();
                                    let type = $(targetForm).find('.add-recommendation-type:checked').val();
                                    let feedbackErrorElement = $(targetForm).find(`#add-recommendation-content-${recommendationName}`);
                                    let typeErrorElement = $(targetForm).find(`#add-recommendation-type-${recommendationName}`);
                                    let translations = {
                                      "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                      "success": "Changes saved successfully"
                                    }
                                    if (recommendationType == 'page') {
                                      section = recommendationSection;
                                      field = '';
                                    }
                                    if (feedback == '' && type == undefined) {
                                      feedbackErrorElement.removeClass('hide')
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (feedback == '') {
                                      feedbackErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (type == undefined) {
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    let formData = {
                                      "type": type,
                                      "section": section,
                                      "field": field,
                                      "feedback": feedback
                                    }
                                    let options = {
                                      credentials: 'same-origin',
                                      headers: {
                                        'Accept': 'application/json',
                                        'Content-Type': 'application/json'
                                      },
                                      method: 'POST',
                                      body: JSON.stringify(formData)
                                    }
                                    let url = '/4/listings/95462/feedback/json/create'
                                    fetch(url, options).then(function(response) {
                                      if (response.status != 400 && response.status != 200) {
                                        flash.error(translations.error);
                                        console.log(response);
                                      } else {
                                        flash.success(translations.success, function() {
                                          flash.clear()
                                        });
                                        $(`#add_recommendations_modal_${recommendationName}`).modal('hide')
                                        return response.json()
                                      }
                                    })
                                  }
                                </script>
                              </div>
                              <script>
                                function showRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).next().toggleClass('hide');
                                }
    
                                function hideRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).prev().toggleClass('hide');
                                }
                              </script>
                            </div>
                          </div>
                          <div class="col-lg-6 col-md-9 col-xs-12">
                            <div class="form-group">
                              <style>
                                #id_foods {
                                  columns: 2;
                                -webkit-columns: 2;
                                -moz-columns: 2;
                                list-style-type: none;
                              }
                              </style>
                              {{ form.foods }}
                            </div>
                            <script>
                              function completeRecommendation(recommendationId) {
                                let translations = {
                                  "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                  "success": "Changes saved successfully"
                                };
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/complete`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    flash.error(translations.error);
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ Done ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function dismissRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/dismiss`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    if (recommendationType == 'comment') {
                                      flash.error(translations.error);
                                    } else {
                                      flash.error(translations.error);
                                    }
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ DISMISSED ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function deleteRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/delete`
                                if (window.confirm("Are you sure?")) {
                                  fetch(url, options).then(function(response) {
                                    if (response.status != 200) {
                                      flash.error(translations.error);
                                      console.log(response);
                                    } else {
                                      flash.success(translations.success, function() {
                                        flash.clear()
                                      });
                                      $(targetElement).closest('.panel-body').hide();
                                      return response.json()
                                    }
                                  })
                                }
                              }
    
                              function editRecommendation(recommendationName, type, id) {
                                $(`#edit_recommendations_modal_${recommendationName}_${type}_${id}`).modal('show');
                              }
                            </script>
                          </div>
                        </div>
                        <div class="row section-title divider-on-top">
                          <div class="col-md-9 col-sm-12">
                            <h3>Drinks</h3>
                          </div>
                        </div>
                        <!-- ------------------------------------------------SUPPORTED DRINK TYPES --------------------------------------- -->
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-group">
                              <label for="host" class="control-label label-block"> Drink types included </label>
                              <div class="form-helper"> Select all drink types that are served. </div>
                              <div class="recommendation-actions">
                                <div class="modal fade add_recommendations_modal" id="add_recommendations_modal_supportedDrinkTypes" tabindex="-1" role="dialog" aria-label>
                                  <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">
                                            <img src="./recommendationsClose.svg" class="add-recommendations-modal__close__image" />
                                          </span>
                                        </button>
                                        <div class="modal-header__content">
                                          <img src="./recommendations.svg" class="add-recommendations-modal__title__image" />
                                          <h3>Add recommendation</h3>
                                        </div>
                                      </div>
                                      <div class="add_recommendations_form">
                                        <div class="modal-body">
                                          <div class="form-group">
                                            <label for="add-recommendation-title">Recommendation for</label>
                                            <input type="text" class="form-control add-recommendation-title" placeholder="Drink types included (field)" value="Drink types included (field)" readonly />
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-type">Type <span id="add-recommendation-type-supportedDrinkTypes" class="badge hide">Required</span>
                                            </label>
                                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="comment" class="add-recommendation-type" autocomplete="off"> Comment </label>
                                              <label class="btn btn-default">
                                                <input type="radio" name="type" value="suggestion" autocomplete="off" class="add-recommendation-type"> Improvement </label>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label for="add-recommendation-content">Recommendation <span id="add-recommendation-content-supportedDrinkTypes" class="badge hide">Required</span>
                                            </label>
                                            <textarea class="form-control add-recommendation-content" rows="3"></textarea>
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                          <button class="btn btn-success add-recommendation-button" type="button" onclick="addRecommendation('supportedDrinkTypes', 'field', 'foodAndDrinks')">Save</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <script>
                                  function addRecommendation(recommendationName, recommendationType, recommendationSection) {
                                    let field = recommendationName;
                                    let section = recommendationSection;
                                    let targetForm = event.target.closest('.add_recommendations_form')
                                    let feedback = $(targetForm).find('.add-recommendation-content').val();
                                    let type = $(targetForm).find('.add-recommendation-type:checked').val();
                                    let feedbackErrorElement = $(targetForm).find(`#add-recommendation-content-${recommendationName}`);
                                    let typeErrorElement = $(targetForm).find(`#add-recommendation-type-${recommendationName}`);
                                    let translations = {
                                      "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                      "success": "Changes saved successfully"
                                    }
                                    if (recommendationType == 'page') {
                                      section = recommendationSection;
                                      field = '';
                                    }
                                    if (feedback == '' && type == undefined) {
                                      feedbackErrorElement.removeClass('hide')
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (feedback == '') {
                                      feedbackErrorElement.removeClass('hide');
                                      return;
                                    }
                                    if (type == undefined) {
                                      typeErrorElement.removeClass('hide');
                                      return;
                                    }
                                    let formData = {
                                      "type": type,
                                      "section": section,
                                      "field": field,
                                      "feedback": feedback
                                    }
                                    let options = {
                                      credentials: 'same-origin',
                                      headers: {
                                        'Accept': 'application/json',
                                        'Content-Type': 'application/json'
                                      },
                                      method: 'POST',
                                      body: JSON.stringify(formData)
                                    }
                                    let url = '/4/listings/95462/feedback/json/create'
                                    fetch(url, options).then(function(response) {
                                      if (response.status != 400 && response.status != 200) {
                                        flash.error(translations.error);
                                        console.log(response);
                                      } else {
                                        flash.success(translations.success, function() {
                                          flash.clear()
                                        });
                                        $(`#add_recommendations_modal_${recommendationName}`).modal('hide')
                                        return response.json()
                                      }
                                    })
                                  }
                                </script>
                              </div>
                              <script>
                                function showRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).next().toggleClass('hide');
                                }
    
                                function hideRecommendationHistory(name) {
                                  let currentElement = event.target;
                                  $(`#view_recommendations_history_container_${name}`).toggleClass('hide');
                                  $(currentElement).toggleClass('hide');
                                  $(currentElement).prev().toggleClass('hide');
                                }
                              </script>
                            </div>
                          </div>
                          <div class="col-lg-6 col-md-9 col-xs-12">
                            <div class="form-group">
                              {{ form.drinks }}
                            </div>
                            <script>
                              function completeRecommendation(recommendationId) {
                                let translations = {
                                  "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                  "success": "Changes saved successfully"
                                };
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/complete`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    flash.error(translations.error);
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ Done ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function dismissRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/dismiss`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    if (recommendationType == 'comment') {
                                      flash.error(translations.error);
                                    } else {
                                      flash.error(translations.error);
                                    }
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ DISMISSED ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function deleteRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/delete`
                                if (window.confirm("Are you sure?")) {
                                  fetch(url, options).then(function(response) {
                                    if (response.status != 200) {
                                      flash.error(translations.error);
                                      console.log(response);
                                    } else {
                                      flash.success(translations.success, function() {
                                        flash.clear()
                                      });
                                      $(targetElement).closest('.panel-body').hide();
                                      return response.json()
                                    }
                                  })
                                }
                              }
    
                              function editRecommendation(recommendationName, type, id) {
                                $(`#edit_recommendations_modal_${recommendationName}_${type}_${id}`).modal('show');
                              }
                            </script>
                          </div>
                        </div>
                        <div class="row section-title divider-on-top">
                          <div class="col-md-9 col-sm-12">
                            <h3> Food description </h3>
                            <small class="title-description"> Add other details that can help set the customers&#39; expections on food and inclusions. If the meals are not included, share the restaurants in the area </small>
                          </div>
                        </div>
                        <!-- ------------------------------------------------FOOD --------------------------------------- -->
                        <div class="row">

                          <div class="col-lg-6 col-md-9 col-xs-12">
                            <div class="form-group">
                              {{ form.food_info }}
                            </div>
                            <script>
                              function completeRecommendation(recommendationId) {
                                let translations = {
                                  "error": "There was an error saving your changes. Please reload the page and try again. If the error persists, contact your account manager.",
                                  "success": "Changes saved successfully"
                                };
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/complete`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    flash.error(translations.error);
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ Done ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function dismissRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/dismiss`
                                fetch(url, options).then(function(response) {
                                  if (response.status != 200) {
                                    if (recommendationType == 'comment') {
                                      flash.error(translations.error);
                                    } else {
                                      flash.error(translations.error);
                                    }
                                    console.log(response);
                                  } else {
                                    flash.success(translations.success, function() {
                                      flash.clear()
                                    });
                                    $(targetElement).closest('.panel-body').find('.content-section span').html('[ DISMISSED ]');
                                    $(targetElement).closest('.button-section').hide();
                                    return response.json()
                                  }
                                })
                              }
    
                              function deleteRecommendation(recommendationId, recommendationType) {
                                let targetElement = event.target;
                                let options = {
                                  credentials: 'same-origin',
                                  headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                  },
                                  method: 'POST'
                                }
                                let url = `/4/listings/95462/feedback/${recommendationId}/json/delete`
                                if (window.confirm("Are you sure?")) {
                                  fetch(url, options).then(function(response) {
                                    if (response.status != 200) {
                                      flash.error(translations.error);
                                      console.log(response);
                                    } else {
                                      flash.success(translations.success, function() {
                                        flash.clear()
                                      });
                                      $(targetElement).closest('.panel-body').hide();
                                      return response.json()
                                    }
                                  })
                                }
                              }
    
                              function editRecommendation(recommendationName, type, id) {
                                $(`#edit_recommendations_modal_${recommendationName}_${type}_${id}`).modal('show');
                              }
                            </script>
                          </div>
                        </div>
                        <div class="fixed-actions fixed-actions--bottom fixed-actions--right">
                            <button class="btn btn-success js-submit-listing-edit-form"> Save </button>
                          </div>
                      </form>

                    </div>
                  </div>
            </div>
            {% endblock %}